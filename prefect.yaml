name: entry-remove-project
prefect-version: 3.2.14

# build section allows you to manage and build docker images
build: null

# push section allows you to manage if and how this project is uploaded to remote locations
push: null

# Local execution + Cloud "test" workspace via a local worker.
# - Runs flows/entry_remove_flow.py:run_entry_remove
# - Local data/* defaults; S3 supported via runtime params
# - No git pull step (youâ€™re testing from your local checkout)

# Clone the EntryRemoval-Prefect repo on each run so workers get the latest flows & code.
pull:
  - prefect.deployments.steps.git_clone:
      id: clone-step
      repository: https://github.com/CBIIT/EntryRemoval-Prefect.git
      branch: main
      
  - prefect.deployments.steps.pip_install_requirements:
      requirements_file: requirements.txt
      directory: "{{ clone-step.directory }}"
      stream_output: False

# the deployments section provides configurations for deploying flows
deployments:
- name: ccdi-entry-removal-v1
  version: null
  tags: ["ENTRY REMOVE"]
  description: "Entry remove flow for CCDI workspace using ccdi-validation S3 bucket"
  entrypoint: flows/entry_remove_flow.py:run_entry_remove
  schedule: null
  
  # flow-specific parameters
  parameters:
    s3_bucket: ""
    manifest_key: ""
    template_key: ""
    entries_key: ""
    outputs_glob: ""
    output_prefix: ""
    #manifest_path: ""
    #template_path: ""
    #entries_path: ""
    #s3_output_prefix: ""
  
  work_pool:
    name: ccdi-curation-8gb-prefect-3.2.14-python3.9
    work_queue_name:
    job_variables: {}
  schedules: []

  
  # pull action to overwrite from file pull action
  pull: 
    - prefect.deployments.steps.git_clone:
      id: clone-step
      repository: https://github.com/CBIIT/EntryRemoval-Prefect.git
      branch: main
    - prefect.deployments.steps.pip_install_requiements: 
        requirements_file: requirements.txt
        directory: "{{ clone-step.directory }}"
        stream_output: False
    # - prefect.deployments.steps.run_shell_script:
        # script: |
        # apt-get update -y
        # apt-get install -y ca-certificates
        # apt install maven -y
    # stream_output: true
  
